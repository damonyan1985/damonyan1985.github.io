<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#000000" />
</head>
<body>
  <div id="boyia-blog"><p style="text-align: center;"><span style="font-size: 24pt;"><strong>V8引擎学习笔记</strong></span></p>
<p style="text-align: left;"><span style="font-size: 18pt;"><strong>1. 基础类</strong></span></p>
<p class="MsoListParagraph" style="margin-left: 63.0pt; text-indent: -63.0pt; mso-text-indent-alt: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level3 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;"><span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>i.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">v8::Isolate</span>与<span lang="EN-US">internal::Isolate</span></p>
<p class="MsoListParagraph" style="margin-left: 84.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level4 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">1.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]-->实际的实现在<span lang="EN-US">internal::Isolate</span>中，<span lang="EN-US">v8::Isolate</span>只是强转套壳，每次调用<span lang="EN-US">v8::Isolate</span>的方法都需要进行强制转换，例如调用<span lang="EN-US">v8::Isolate::Dispose</span>方法</p>
<p class="MsoListParagraph" style="margin-left: 105.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level5 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin; background: yellow; mso-highlight: yellow;"><span style="mso-list: Ignore;">a)<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US" style="background: yellow; mso-highlight: yellow;">I::Isolate* isolate = reinterpret_cast&lt;I::Isolate*&gt;(this);</span></p>
<p class="MsoListParagraph" style="margin-left: 63.0pt; text-indent: -63.0pt; mso-text-indent-alt: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level3 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;"><span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ii.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">v8::Context</span>与<span lang="EN-US">internal::Context</span></p>
<p class="MsoListParagraph" style="margin-left: 84.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level4 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">1.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]-->两者关系与上面<span lang="EN-US">isolate</span>之间的关系一样，调用时都是通过强转来获取<span lang="EN-US">internal::Context</span></p>
<p class="MsoListParagraph" style="margin-left: 84.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level4 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">2.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">Context</span>表示当前<span lang="EN-US">js</span>执行环境的上下文，会初始化内部函数<span lang="EN-US">builtins</span></p>
<p class="MsoListParagraph" style="margin-left: 63.0pt; text-indent: -63.0pt; mso-text-indent-alt: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level3 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;"><span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>iii.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">Local</span>与<span lang="EN-US">Persistent</span></p>
<p class="MsoListParagraph" style="margin-left: 84.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level4 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">1.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">Local&lt;T&gt;::New</span>会在<span lang="EN-US">HandleScopeData</span>上进行分配<span lang="EN-US">slot</span></p>
<p class="MsoListParagraph" style="margin-left: 84.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level4 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">2.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">Persistent&lt;T&gt;::New</span>会在<span lang="EN-US">GlobalizeReference</span>上分配<span lang="EN-US">slot</span></p>
<p class="MsoListParagraph" style="margin-left: 63.0pt; text-indent: -63.0pt; mso-text-indent-alt: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level3 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;"><span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>iv.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]-->对象，奇技淫巧，实际对象并非使用<span lang="EN-US">new Type</span>来完成，而是通过<span lang="EN-US">allocator</span>分配一段内存，对指针进行强制转换</p>
<p class="MsoListParagraph" style="margin-left: 84.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level4 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">1.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">Object</span></p>
<p class="MsoListParagraph" style="margin-left: 84.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level4 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">2.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">Smi</span></p>
<p class="MsoListParagraph" style="margin-left: 84.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level4 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">3.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">HeapObject</span></p>
<p class="MsoListParagraph" style="margin-left: 63.0pt; text-indent: -63.0pt; mso-text-indent-alt: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level3 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;"><span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>v.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]-->内存分配</p>
<p class="MsoListParagraph" style="margin-left: 84.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level4 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">1.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]-->入口为<span lang="EN-US">isolate-&gt;heap()</span>对象进行分配，例如</p>
<p class="MsoListParagraph" style="margin-left: 105.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level5 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">a)<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">String::NewFromUtf8</span></p>
<p class="MsoListParagraph" style="margin-left: 105.0pt; text-indent: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level5 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;">b)<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">Heap</span>分配内存时会进行选择<span lang="EN-US">space</span>对象，<span lang="EN-US">space</span>主要分为</p>
<p class="MsoListParagraph" style="margin-left: 126.0pt; text-indent: -126.0pt; mso-text-indent-alt: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level6 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;"><span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>i.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">Newspace</span>（<span lang="EN-US">gc</span>中包含<span lang="EN-US">s0, s1</span>）</p>
<p class="MsoListParagraph" style="margin-left: 126.0pt; text-indent: -126.0pt; mso-text-indent-alt: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level6 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;"><span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ii.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">OldSpace</span></p>
<p class="MsoListParagraph" style="margin-left: 126.0pt; text-indent: -126.0pt; mso-text-indent-alt: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level6 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;"><span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>iii.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]--><span lang="EN-US">CodeSpace</span></p>
<p class="MsoListParagraph" style="margin-left: 126.0pt; text-indent: -126.0pt; mso-text-indent-alt: -21.0pt; mso-char-indent-count: 0; mso-list: l0 level6 lfo1;"><!-- [if !supportLists]--><span lang="EN-US" style="mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-latin; mso-bidi-font-family: 等线; mso-bidi-theme-font: minor-latin;"><span style="mso-list: Ignore;"><span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>iv.<span style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><!--[endif]-->等等</p></div>
</body>
</html>